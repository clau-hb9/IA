// **RECUERDA** PRIORIDAD EN FUNCIÓN DEL ORDEN DE LAS REGLAS (LA SUPERIOR LA MÁS PRIORITARIA)

rule tareas_hechas{
declarations
    practica.objetos.Tarea t;
  preconditions
    t.getUnidades()<=0;
    //si la tarea ya esta hecha que la elimine de la BHH
  actions
 	retract(t);
}

rule coger_primera_herramienta {
  declarations
    practica.objetos.Trabajador w;
    practica.objetos.Tarea t;
    practica.objetos.Herramienta nuevaH;
  preconditions
  	w.getArea().equals("A");
  	//si un trabajador esta en A
  	nuevaH.getArea().equals("A");
  	//si la herramienta a coger esta en A
  	nuevaH.getTrabajo().equals(t.getTipo());
  	//si la nueva herramienta vale para hacer una tarea inacabada
  	w.getHerramienta()==null;
  	//si el trabajador no tenia herramienta
  actions
  	w.setHerramienta(nuevaH);
  	//cambiamos la herramienta del trabajador por la nueva
  	w.imprimeH();
  	modified(w);
}

rule hacer_tarea_limpieza {
  declarations
    practica.objetos.Tarea t;
    practica.objetos.Trabajador w;
  preconditions
    w.getHerramienta().getTrabajo().equals("limpiar");
    t.getTipo().equals("limpiar");
    t.getArea().equals(w.getArea());
    //si el trabajador se encuantra en el area de esa tarea
    w.getHabLimpiar()>0;
    //si el trabajador tiene habilidad para hacer esa tarea
  actions
 	t.setUnidades(t.getUnidades()-w.getHabLimpiar());
 	//determinamos las unidades que quedan por hacer
 	t.imprime( w.getHerramienta(),w);
 	modified(t);
}

rule hacer_tarea_reparacion {
  declarations
    practica.objetos.Tarea t;
    practica.objetos.Trabajador w;
  preconditions
    w.getHerramienta().getTrabajo().equals("reparar");
    t.getTipo().equals("reparar");
    t.getArea().equals(w.getArea());
    w.getHabReparar()>0;
  actions
 	t.setUnidades(t.getUnidades()-w.getHabReparar());
 	t.imprime( w.getHerramienta(),w);
 	modified(t);
}

rule hacer_tarea_poda {
  declarations
    practica.objetos.Tarea t;
    practica.objetos.Trabajador w;
  preconditions
    w.getHerramienta().getTrabajo().equals("podar");
    t.getTipo().equals("podar");
    t.getArea().equals(w.getArea());
    w.getHabPodar()>0;	
  actions
 	t.setUnidades(t.getUnidades()-w.getHabPodar());
 	t.imprime(w.getHerramienta(),w);
 	modified(t);
}

rule moverse_hacer_tarea_adyacente {
  declarations
    practica.objetos.Area a;
    practica.objetos.Trabajador w;
    practica.objetos.Tarea t;
    practica.objetos.Herramienta h;
  preconditions
  	t.getArea().equals(a.getNombre()); 
  	//si en ese area hay una tarea por hacer
  	t.getTipo().equals(w.getHerramienta().getTrabajo()); 
  	//si el trabajador tiene la herramienta necesaria
   	a.esAdyacente(w.getArea());
   	//si ese area es adyacente al area del trabajdor
   	!a.getNombre().equals(w.getAreaAnterior());
   	//si ese area no es de donde viene el trabajador(evitar bucles)
   	h.getNombre().equals(w.getHerramienta().getNombre());
   	//para seleccionar la herramienta del trabajador
   	h.getArea().equals(w.getHerramienta().getArea());
   	//para seleccionar la herramienta del trabajador
  actions
  	w.setAreaAnterior(w.getArea());
  	//fijamos area anterior como en el que se encuentra
  	w.setArea(a.getNombre());
  	//movemos al trabajador
  	a.setVisitadaTarea(true,w.getHerramienta().getTrabajo());
  	//poner ese area como visitada
  	h.setArea(w.getArea());
  	//cambiamos el area de la herramienta del trabajador ya que este se ha movido
  	w.imprime(t.getTipo());
  	modified(w);
  	modified(h);
}

rule moverse_hacer_tarea {
  declarations
    practica.objetos.Area a;
    practica.objetos.Trabajador w;
    practica.objetos.Tarea t;
    practica.objetos.Herramienta h;
  preconditions
  	a.esAdyacente(w.getArea());
   	//si ese area es adyacente al area del trabajdor
  	t.getTipo().equals(w.getHerramienta().getTrabajo()); 
  	//si el trabajador tiene la herramienta necesaria
   	!a.getVisitadaTarea(w.getHerramienta().getTrabajo());
   	//si no ha visitado ya ese area
   	!a.getNombre().equals(w.getAreaAnterior());
   	//si ese area no es de donde viene el trabajador(evitar bucles)
   	h.getNombre().equals(w.getHerramienta().getNombre());
   	//para seleccionar la herramienta del trabajador
   	h.getArea().equals(w.getHerramienta().getArea());
   	//para seleccionar la herramienta del trabajador
  actions
  	w.setAreaAnterior(w.getArea());
  	//fijamos area anterior como en el que se encuentra
  	w.setArea(a.getNombre());
  	//movemos al trabajador
  	h.setArea(w.getArea());
  	//cambiamos el area de la herramienta del trabajador ya que este se ha movido
  	a.setVisitadaTarea(true,w.getHerramienta().getTrabajo());
  	//poner ese area como visitada
  	w.imprime(t.getTipo());
  	modified(w);
  	modified(h);
  	modified(a);
}
rule coger_herramienta {
  declarations
    practica.objetos.Trabajador w;
    practica.objetos.Tarea t;
    practica.objetos.Herramienta nuevaH;
  preconditions
  	w.getArea().equals("A");
  	//si el trabajador esta en A
  	nuevaH.getArea().equals("A");
  	//si la nueva herramienta esta en A
  	nuevaH.getTrabajo().equals(t.getTipo());
  	//si vale para hacer una tarea inacabada
  	
  actions
  	w.setHerramienta(nuevaH);
  	//cambiamos la herramienta del trabajador
  	w.imprimeH();
  	modified(w);
}

rule moverse_almacen_adyacente {
  declarations
    practica.objetos.Area a;
    practica.objetos.Trabajador w;
    practica.objetos.Tarea t;
    practica.objetos.Herramienta h;
  preconditions
  //ES IGUAL QUE moverse_hacer_tarea_adyacente SIN LA CONDICION DE QUE EL TRABAJADOR TIENE LA HERRAMIENTA NECESARIA PARA HACER UNA TAREA
  	a.getNombre().equals("A");
  	t.getUnidades()>0;
   	a.esAdyacente(w.getArea());
   	//!a.getNombre().equals(w.getAreaAnterior());
   	h.getNombre().equals(w.getHerramienta().getNombre());
   	h.getArea().equals(w.getHerramienta().getArea());
  actions
  	w.setAreaAnterior(w.getArea());
  	w.setArea(a.getNombre());
  	h.setArea(w.getArea());
  	w.imprime(t.getTipo());
  	modified(w);
  	modified(h);
}
rule moverse_almacen {
  declarations
    practica.objetos.Area a;
    practica.objetos.Trabajador w;
    practica.objetos.Tarea t;
    practica.objetos.Herramienta h;
  preconditions
  //ES IGUAL QUE moverse_hacer_tarea_adyacente SIN LA CONDICION DE QUE EL TRABAJADOR TIENE LA HERRAMIENTA NECESARIA PARA HACER UNA TAREA
  	t.getUnidades()>0;
   	!a.getVisitadaAlmacen(w.getNombre());
   	h.getNombre().equals(w.getHerramienta().getNombre());
   	h.getArea().equals(w.getHerramienta().getArea());
  actions
  	w.setAreaAnterior(w.getArea());
  	w.setArea(a.getNombre());
  	h.setArea(w.getArea());
  	a.setVisitadaAlmacen(true,w.getNombre());
  	w.imprime(t.getTipo());
  	modified(w);
  	modified(h);
  	modified(a);
}